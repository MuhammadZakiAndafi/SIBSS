"use strict";var db=require("../models"),fs=require("fs"),path=require("path"),PDFDocument=require("pdfkit");exports.showSk=function(r,n){var t,a,u,s,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=r.session.user.id,a=r.session.user,u=a.role,e.next=6,regeneratorRuntime.awrap(db.Pengajuan.findOne({where:{userId:t}}));case 6:return s=e.sent,e.next=9,regeneratorRuntime.awrap(db.SuratKeputusan.findAll({where:{pengajuanId:s.id},include:[{model:db.Pengajuan}]}));case 9:o=e.sent,n.render("user/suratkeputusan",{sks:o,title:"Surat Keputusan",userRole:u}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Error fetching surat keputusan:",e.t0),n.status(500).send("Internal Server Error");case 17:case"end":return e.stop()}},null,null,[[0,13]])},exports.generateSK=function(r,n){var t,a,u,s,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=r.params.id,e.next=4,regeneratorRuntime.awrap(db.Pengajuan.findOne({where:{id:t},include:[db.SuratKeputusan]}));case 4:if(a=e.sent){e.next=8;break}return r.flash("error","Pengajuan tidak ditemukan."),e.abrupt("return",n.redirect("/daftarPengajuan"));case 8:u=new PDFDocument,s=path.join(__dirname,"..","tmp","sk_".concat(t,".pdf")),o=fs.createWriteStream(s),u.pipe(o),u.fontSize(12),u.text("Surat Keputusan"),u.moveDown(),u.text("Nomor Surat: ".concat(a.SuratKeputusan.nomor)),u.text("Tanggal: ".concat(a.SuratKeputusan.tanggal.toDateString())),u.end(),o.on("finish",function(){n.download(s,"SK_".concat(t,".pdf"),function(e){e&&(console.error("Error sending file:",e),n.status(500).send("Failed to download file.")),fs.unlinkSync(s)})}),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(0),console.error("Error generating SK:",e.t0),r.flash("error","Failed to generate SK"),n.redirect("/daftarPengajuan");case 26:case"end":return e.stop()}},null,null,[[0,21]])};
//# sourceMappingURL=skController.min.js.map
