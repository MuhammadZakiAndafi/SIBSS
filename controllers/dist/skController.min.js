"use strict";var db=require("../models"),fs=require("fs"),path=require("path"),PDFDocument=require("pdfkit");exports.showSk=function(r,t){var n,a,u,s,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.session.user.id,a=r.session.user,u=a.role,e.next=6,regeneratorRuntime.awrap(db.Pengajuan.findOne({where:{userId:n}}));case 6:return s=e.sent,e.next=9,regeneratorRuntime.awrap(db.SuratKeputusan.findAll({where:{pengajuanId:s.id},include:[{model:db.Pengajuan}]}));case 9:o=e.sent,t.render("user/suratkeputusan",{sks:o,title:"Surat Keputusan",userRole:u}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Error fetching surat keputusan:",e.t0),t.status(500).send("Internal Server Error");case 17:case"end":return e.stop()}},null,null,[[0,13]])},exports.generateSK=function(r,t){var n,a,u,s,o,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.params.id,e.next=4,regeneratorRuntime.awrap(db.Pengajuan.findOne({where:{id:n},include:[db.SuratKeputusan]}));case 4:if(a=e.sent){e.next=8;break}return r.flash("error","Pengajuan tidak ditemukan."),e.abrupt("return",t.redirect("/daftarPengajuan"));case 8:if(u=new PDFDocument,s=path.join(__dirname,"..","output"),fs.existsSync(s)||fs.mkdirSync(s),o=path.join(s,"sk_".concat(n,".pdf")),c=fs.createWriteStream(o),u.pipe(c),u.fontSize(12),u.text("Surat Keputusan"),u.moveDown(),a.SuratKeputusan?(u.text("Nomor Surat: ".concat(a.SuratKeputusan.nomor)),u.text("Tanggal: ".concat(a.SuratKeputusan.tanggal.toDateString()))):(u.text("Nomor Surat: -"),u.text("Tanggal: -")),u.end(),a.SuratKeputusan){e.next=22;break}return e.next=22,regeneratorRuntime.awrap(db.SuratKeputusan.create({pengajuanId:n,nomor:"",tanggal:new Date,keterangan:"",lampiran:""}));case 22:t.status(201).send("SK generated successfully and saved to ".concat(o)),e.next=30;break;case 25:e.prev=25,e.t0=e.catch(0),console.error("Error generating SK:",e.t0),r.flash("error","Failed to generate SK"),t.redirect("/daftarPengajuan");case 30:case"end":return e.stop()}},null,null,[[0,25]])};
//# sourceMappingURL=skController.min.js.map
