"use strict";var db=require("../models"),fs=require("fs"),path=require("path"),PDFDocument=require("pdfkit");exports.showSk=function(e,n){var t,r,i,u,o;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,t=e.session.user.id,r=e.session.user,i=r.role,a.next=6,regeneratorRuntime.awrap(db.Pengajuan.findOne({where:{userId:t}}));case 6:return u=a.sent,a.next=9,regeneratorRuntime.awrap(db.SuratKeputusan.findAll({where:{pengajuanId:u.id},include:[{model:db.Pengajuan}]}));case 9:o=a.sent,n.render("user/suratkeputusan",{sks:o,title:"Surat Keputusan",userRole:i}),a.next=17;break;case 13:a.prev=13,a.t0=a.catch(0),console.error("Error fetching surat keputusan:",a.t0),n.status(500).send("Internal Server Error");case 17:case"end":return a.stop()}},null,null,[[0,13]])},exports.generateSK=function(e,n){var t,r,i,u,o,s;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,t=e.params.id,a.next=4,regeneratorRuntime.awrap(db.Pengajuan.findOne({where:{id:t},include:[db.SuratKeputusan]}));case 4:if(r=a.sent){a.next=8;break}return e.flash("error","Pengajuan tidak ditemukan."),a.abrupt("return",n.redirect("/daftarPengajuan"));case 8:if(i=new PDFDocument,u=path.join(__dirname,"..","output"),fs.existsSync(u)||fs.mkdirSync(u),o=path.join(u,"sk_".concat(t,".pdf")),s=fs.createWriteStream(o),i.pipe(s),i.fontSize(12),i.text("Surat Keputusan"),i.moveDown(),r.SuratKeputusan?(i.text("Nomor Surat: ".concat(r.SuratKeputusan.nomor)),i.text("Tanggal: ".concat(r.SuratKeputusan.tanggal.toDateString()))):(i.text("Nomor Surat: -"),i.text("Tanggal: -"),i.text("KEPUTUSAN REKTOR UNIVERSITAS ANDALAS",{fontSize:24,fontWeight:"bold"}),i.text("Nomor 1084/XIV/R/KPT/2024"),i.text("BERHENTI STUDI SEMENTARA MAHASISWA PROGRAM SARJANA UNIVERSITAS ANDALAS PADA SEMESTER GENAP TAHUN AKADEMIK 2023/2024",{fontSize:18,fontWeight:"bold"}),i.text("REKTOR UNIVERSITAS ANDALAS,",{fontSize:18,fontWeight:"bold"}),i.text("Membaca:",{fontSize:14,fontWeight:"bold"}),i.text("Surat Permohonan Berhenti Studi Sementara mahasiswa Program Sarjana Universitas Andalas atas nama ".concat(r.name," NIM. ").concat(r.nim," dan kawan-kawan yang telah disetujui Dekan/Direktur Fakultas/Program di lingkungan Universitas Andalas")),i.text("Menimbang:",{fontSize:14,fontWeight:"bold"}),i.text("a. bahwa berdasarkan Peraturan Rektor Nomor 3 Tahun 2016 tentang peraturan akademik Universitas Andalas, kepada ".concat(r.name," NIM. ").concat(r.nim," dan kawan-kawan dapat diberikan izin untuk Berhenti Studi Sementara;")),i.text("b. bahwa untuk pelaksanaan hal tersebut pada butir a di atas perlu ditetapkan dengan Keputusan Rektor."),i.text("Mengingat:",{fontSize:14,fontWeight:"bold"}),i.text("1. Undang-Undang Nomor 12 Tahun 2012 tentang Pendidikan Tinggi (Lembaran Negara Republik Indonesia Tahun 2012 Nomor 158, Tambahan Lembaran Negara Republik Indonesia Nomor 5336);"),i.text("2. Peraturan Pemerintah Nomor 4 Tahun 2014 tentang Penyelenggaraan Pendidikan Tinggi dan Pengelolaan Perguruan Tinggi (Lembaran Negara Republik Indonesia Tahun 2014 Nomor 14, Tambahan Lembaran Negara Republik Indonesia Nomor 5500);"),i.text("3. Peraturan Presiden Republik Indonesia Nomor 8 tahun 2012 tentang Kerangka Kualifikasi Nasional Indonesia (KKNI) (Lembaran Negara Republik Indonesia Tahun 2012 Nomor 24);"),i.text("4. Peraturan Menteri Pendidikan dan Kebudayaan Republik Indonesia Nomor 25 Tahun 2012 tentang Organisasi dan Tata Kerja Universitas Andalas (Berita Negara Republik Indonesia Tahun 2012 Nomor 434);"),i.text("5. Peraturan Menteri Pendidikan dan Kebudayaan Republik Indonesia Nomor 47 Tahun 2013 tentang Statuta Universitas Andalas (Berita Negara Republik Indonesia Tahun 2013 Nomor 596);")),i.end(),r.SuratKeputusan){a.next=22;break}return a.next=22,regeneratorRuntime.awrap(db.SuratKeputusan.create({pengajuanId:t,nomor:"",tanggal:new Date,keterangan:"",lampiran:""}));case 22:n.status(201).send("SK generated successfully and saved to ".concat(o)),a.next=30;break;case 25:a.prev=25,a.t0=a.catch(0),console.error("Error generating SK:",a.t0),e.flash("error","Failed to generate SK"),n.redirect("/daftarPengajuan");case 30:case"end":return a.stop()}},null,null,[[0,25]])};
//# sourceMappingURL=skController.min.js.map
