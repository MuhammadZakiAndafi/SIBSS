{"version":3,"sources":["createSK.js"],"names":["PDFDocument","require","fs","ejs","promisify","db","exports","generate","req","res","generatePDF","data","outputPath","renderFile","__dirname","html","doc","pipe","createWriteStream","text","align","end","userId","session","user","id","userlogin","userRole","role","Pengajuan","findOne","where","pengajuan","SuratKeputusan","findAll","pengajuanId","include","model","sks","render","title","module","console","error","status","send"],"mappings":";;AAAA,IAAMA,WAAW,GAAGC,OAAO,CAAC,QAAD,CAA3B;;AACA,IAAMC,EAAE,GAAGD,OAAO,CAAC,IAAD,CAAlB;;AACA,IAAME,GAAG,GAAGF,OAAO,CAAC,KAAD,CAAnB;;eACsBA,OAAO,CAAC,MAAD,C;IAArBG,S,YAAAA,S;;AACR,IAAMC,EAAE,GAAGJ,OAAO,CAAC,WAAD,CAAlB;;AAEAK,OAAO,CAACC,QAAR,GAAmB,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAsBGC,UAAAA,WAtBH,GAsBZ,SAAeA,WAAf,CAA2BC,IAA3B,EAAiCC,UAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oDACuBC,UAAU,CAACC,SAAS,GAAG,qBAAb,EAAoCH,IAApC,CADjC;;AAAA;AACUI,oBAAAA,IADV;AAGUC,oBAAAA,GAHV,GAGgB,IAAIhB,WAAJ,EAHhB;AAIIgB,oBAAAA,GAAG,CAACC,IAAJ,CAASf,EAAE,CAACgB,iBAAH,CAAqBN,UAArB,CAAT;AAEAI,oBAAAA,GAAG,CAACG,IAAJ,CAASJ,IAAT,EAAe;AACXK,sBAAAA,KAAK,EAAE;AADI,qBAAf;AAIAJ,oBAAAA,GAAG,CAACK,GAAJ;;AAVJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAtBY;;AAEXC,UAAAA,MAFW,GAEFd,GAAG,CAACe,OAAJ,CAAYC,IAAZ,CAAiBC,EAFf,EAEmB;;AAC5BC,UAAAA,SAHS,GAGGlB,GAAG,CAACe,OAAJ,CAAYC,IAHf;AAITG,UAAAA,QAJS,GAIED,SAAS,CAACE,IAJZ,EAIkB;AACjC;;AALe;AAAA,0CAMSvB,EAAE,CAACwB,SAAH,CAAaC,OAAb,CAAqB;AAC3CC,YAAAA,KAAK,EAAE;AAAET,cAAAA,MAAM,EAAEA;AAAV;AADoC,WAArB,CANT;;AAAA;AAMTU,UAAAA,SANS;AAAA;AAAA,0CASG3B,EAAE,CAAC4B,cAAH,CAAkBC,OAAlB,CAA0B;AAC1CH,YAAAA,KAAK,EAAE;AAAEI,cAAAA,WAAW,EAAEH,SAAS,CAACP;AAAzB,aADmC;AAE1CW,YAAAA,OAAO,EAAE,CAAC;AAACC,cAAAA,KAAK,EAAEhC,EAAE,CAACwB;AAAX,aAAD;AAFiC,WAA1B,CATH;;AAAA;AASTS,UAAAA,GATS;AAcf7B,UAAAA,GAAG,CAAC8B,MAAJ,CAAW,WAAX,EAAwB;AACrBD,YAAAA,GAAG,EAAHA,GADqB;AAErBE,YAAAA,KAAK,EAAE,iBAFc;AAGrBb,YAAAA,QAAQ,EAARA;AAHqB,WAAxB;AAMSd,UAAAA,UApBM,GAoBOT,SAAS,CAACD,GAAG,CAACU,UAAL,CApBhB;AAmCZ4B,UAAAA,MAAM,CAACnC,OAAP,GAAiBI,WAAjB;AAnCY;AAAA;;AAAA;AAAA;AAAA;AAqCnBgC,UAAAA,OAAO,CAACC,KAAR,CAAc,uBAAd;AACAlC,UAAAA,GAAG,CAACmC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,uBAArB;;AAtCmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAnB","sourcesContent":["const PDFDocument = require('pdfkit');\r\nconst fs = require('fs');\r\nconst ejs = require('ejs');\r\nconst { promisify } = require('util');\r\nconst db = require('../models');\r\n\r\nexports.generate = async (req, res) => {\r\n  try {\r\n  const userId = req.session.user.id; // Ambil userId dari pengguna yang sedang login\r\n    const userlogin = req.session.user;\r\n    const userRole = userlogin.role; // Mendapatkan role user\r\n    // Ambil pengajuan yang terhubung dengan userId\r\n    const pengajuan = await db.Pengajuan.findOne({\r\n      where: { userId: userId }\r\n    });\r\n    const sks = await db.SuratKeputusan.findAll({\r\n      where: { pengajuanId: pengajuan.id },\r\n      include: [{model: db.Pengajuan}]\r\n    });\r\n\r\n    res.render('/template', {\r\n       sks,\r\n       title: 'Surat Keputusan',\r\n       userRole\r\n       });\r\n\r\n       const renderFile = promisify(ejs.renderFile);\r\n\r\n       async function generatePDF(data, outputPath) {\r\n           const html = await renderFile(__dirname + '/views/template.ejs', data);\r\n       \r\n           const doc = new PDFDocument();\r\n           doc.pipe(fs.createWriteStream(outputPath));\r\n       \r\n           doc.text(html, {\r\n               align: 'justify'\r\n           });\r\n       \r\n           doc.end();\r\n       }\r\n       \r\n       module.exports = generatePDF;\r\n} catch (error) {\r\nconsole.error('Error generating PDF:', error);\r\nres.status(500).send('Internal Server Error');\r\n}\r\n};\r\n"],"file":"createSK.dev.js"}