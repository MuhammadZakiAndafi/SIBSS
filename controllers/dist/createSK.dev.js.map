{"version":3,"sources":["createSK.js"],"names":["PDFDocument","require","fs","db","exports","downloadSK","req","res","userId","session","user","id","userlogin","userRole","role","Pengajuan","findOne","where","pengajuan","SuratKeputusan","findAll","pengajuanId","include","model","sks","render","title","doc","setHeader","name","pipe","fontSize","text","fakultas","align","moveDown","forEach","index","nim","end","console","error","status","send"],"mappings":";;AAAA,IAAMA,WAAW,GAAGC,OAAO,CAAC,QAAD,CAA3B;;AACA,IAAMC,EAAE,GAAGD,OAAO,CAAC,IAAD,CAAlB;;AACA,IAAME,EAAE,GAAGF,OAAO,CAAC,WAAD,CAAlB;;AAEAG,OAAO,CAACC,UAAR,GAAqB,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEbC,UAAAA,MAFa,GAEJF,GAAG,CAACG,OAAJ,CAAYC,IAAZ,CAAiBC,EAFb,EAEiB;;AAC5BC,UAAAA,SAHW,GAGCN,GAAG,CAACG,OAAJ,CAAYC,IAHb;AAIXG,UAAAA,QAJW,GAIAD,SAAS,CAACE,IAJV,EAIgB;AACjC;;AALiB;AAAA,0CAMOX,EAAE,CAACY,SAAH,CAAaC,OAAb,CAAqB;AAC3CC,YAAAA,KAAK,EAAE;AAAET,cAAAA,MAAM,EAAEA;AAAV;AADoC,WAArB,CANP;;AAAA;AAMXU,UAAAA,SANW;AAAA;AAAA,0CASCf,EAAE,CAACgB,cAAH,CAAkBC,OAAlB,CAA0B;AAC1CH,YAAAA,KAAK,EAAE;AAAEI,cAAAA,WAAW,EAAEH,SAAS,CAACP;AAAzB,aADmC;AAE1CW,YAAAA,OAAO,EAAE,CAAC;AAACC,cAAAA,KAAK,EAAEpB,EAAE,CAACY;AAAX,aAAD;AAFiC,WAA1B,CATD;;AAAA;AASXS,UAAAA,GATW;AAcjBjB,UAAAA,GAAG,CAACkB,MAAJ,CAAW,qBAAX,EAAkC;AAC/BD,YAAAA,GAAG,EAAHA,GAD+B;AAE/BE,YAAAA,KAAK,EAAE,iBAFwB;AAG/Bb,YAAAA,QAAQ,EAARA;AAH+B,WAAlC,EAdiB,CAoBrB;;AACMc,UAAAA,GArBe,GAqBT,IAAI3B,WAAJ,EArBS;AAsBrBO,UAAAA,GAAG,CAACqB,SAAJ,CAAc,cAAd,EAA8B,iBAA9B;AACArB,UAAAA,GAAG,CAACqB,SAAJ,CAAc,qBAAd,0CAAqElB,IAAI,CAACmB,IAA1E,aAvBqB,CAyBrB;;AACAF,UAAAA,GAAG,CAACG,IAAJ,CAASvB,GAAT,EA1BqB,CA4BrB;;AACAoB,UAAAA,GAAG,CAACI,QAAJ,CAAa,EAAb,EAAiBC,IAAjB,2EAAyFd,SAAS,CAACe,QAAnG,GAA+G;AAAEC,YAAAA,KAAK,EAAE;AAAT,WAA/G;AACAP,UAAAA,GAAG,CAACQ,QAAJ,CAAa,GAAb;AAEAjB,UAAAA,SAAS,CAACkB,OAAV,CAAkB,UAAClB,SAAD,EAAYmB,KAAZ,EAAsB;AACtCV,YAAAA,GAAG,CAACI,QAAJ,CAAa,EAAb,EAAiBC,IAAjB,WAAyBK,KAAK,GAAG,CAAjC,4BAAoDnB,SAAS,CAACP,EAA9D;AACAgB,YAAAA,GAAG,CAACK,IAAJ,oBAAqBd,SAAS,CAACW,IAA/B;AACAF,YAAAA,GAAG,CAACK,IAAJ,mBAAoBd,SAAS,CAACoB,GAA9B;AACAX,YAAAA,GAAG,CAACK,IAAJ,mBAAoBd,SAAS,CAACM,GAA9B;AACAG,YAAAA,GAAG,CAACQ,QAAJ,CAAa,GAAb;AACD,WAND,EAhCqB,CAwCrB;;AACAR,UAAAA,GAAG,CAACY,GAAJ;AAzCqB;AAAA;;AAAA;AAAA;AAAA;AA2CrBC,UAAAA,OAAO,CAACC,KAAR,CAAc,uBAAd;AACAlC,UAAAA,GAAG,CAACmC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,uBAArB;;AA5CqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAArB","sourcesContent":["const PDFDocument = require('pdfkit');\r\nconst fs = require(\"fs\");\r\nconst db = require('../models');\r\n\r\nexports.downloadSK = async (req, res) => {\r\n  try {\r\n  const userId = req.session.user.id; // Ambil userId dari pengguna yang sedang login\r\n    const userlogin = req.session.user;\r\n    const userRole = userlogin.role; // Mendapatkan role user\r\n    // Ambil pengajuan yang terhubung dengan userId\r\n    const pengajuan = await db.Pengajuan.findOne({\r\n      where: { userId: userId }\r\n    });\r\n    const sks = await db.SuratKeputusan.findAll({\r\n      where: { pengajuanId: pengajuan.id },\r\n      include: [{model: db.Pengajuan}]\r\n    });\r\n\r\n    res.render('user/suratkeputusan', {\r\n       sks,\r\n       title: 'Surat Keputusan',\r\n       userRole\r\n       });\r\n\r\n// Buat dokumen PDF baru\r\nconst doc = new PDFDocument();\r\nres.setHeader('Content-Type', 'application/pdf');\r\nres.setHeader('Content-Disposition', `attachment; filename=\"SK-BSS-${user.name}.pdf\"`);\r\n\r\n// Pipe output PDF ke response\r\ndoc.pipe(res);\r\n\r\n// Tambahkan konten ke PDF\r\ndoc.fontSize(20).text(`Surat Keputusan Berhenti Studi Sementara Tahun Ajaran 2024/2025 ${pengajuan.fakultas}`, { align: 'center' });\r\ndoc.moveDown(0.1);\r\n\r\npengajuan.forEach((pengajuan, index) => {\r\n  doc.fontSize(12).text(`${index + 1}. Nomor surat: ${pengajuan.id}`);\r\n  doc.text(`   Nama: ${pengajuan.name}`);\r\n  doc.text(`   Nim: ${pengajuan.nim}`);\r\n  doc.text(`   SKS: ${pengajuan.sks}`);\r\n  doc.moveDown(0.1);\r\n});\r\n\r\n// Selesaikan dokumen\r\ndoc.end();\r\n} catch (error) {\r\nconsole.error('Error generating PDF:', error);\r\nres.status(500).send('Internal Server Error');\r\n}\r\n};\r\n"],"file":"createSK.dev.js"}