{"version":3,"sources":["skController.js"],"names":["db","require","PDFDocument","fs","exports","showSk","req","res","userId","session","user","id","userlogin","userRole","role","Pengajuan","findOne","where","pengajuan","SuratKeputusan","findAll","pengajuanId","include","model","sks","render","title","console","error","status","send","downloadSK","doc","setHeader","name","pipe","fontSize","text","fakultas","align","moveDown","forEach","index","nim","end"],"mappings":"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","sourcesContent":["const db = require('../models');\r\nconst PDFDocument = require('pdfkit');\r\nconst fs = require(\"fs\");\r\n\r\nexports.showSk = async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id; // Ambil userId dari pengguna yang sedang login\r\n    const userlogin = req.session.user;\r\n    const userRole = userlogin.role; // Mendapatkan role user\r\n    // Ambil pengajuan yang terhubung dengan userId\r\n    const pengajuan = await db.Pengajuan.findOne({\r\n      where: { userId: userId }\r\n    });\r\n    const sks = await db.SuratKeputusan.findAll({\r\n      where: { pengajuanId: pengajuan.id },\r\n      include: [{model: db.Pengajuan}]\r\n    });\r\n\r\n    res.render('user/suratkeputusan', {\r\n       sks,\r\n       title: 'Surat Keputusan',\r\n       userRole\r\n       });\r\n  } catch (error) {\r\n    console.error('Error fetching surat keputusan:', error);\r\n    res.status(500).send('Internal Server Error');\r\n  }\r\n};\r\n\r\nexports.downloadSK = async (req, res) => {\r\n  const userId = req.session.user.id; // Ambil userId dari pengguna yang sedang login\r\n    const userlogin = req.session.user;\r\n    const userRole = userlogin.role; // Mendapatkan role user\r\n    // Ambil pengajuan yang terhubung dengan userId\r\n    const pengajuan = await db.Pengajuan.findOne({\r\n      where: { userId: userId }\r\n    });\r\n    const sks = await db.SuratKeputusan.findAll({\r\n      where: { pengajuanId: pengajuan.id },\r\n      include: [{model: db.Pengajuan}]\r\n    });\r\n\r\n    res.render('user/suratkeputusan', {\r\n       sks,\r\n       title: 'Surat Keputusan',\r\n       userRole\r\n       });\r\n\r\n// Buat dokumen PDF baru\r\nconst doc = new PDFDocument();\r\nres.setHeader('Content-Type', 'application/pdf');\r\nres.setHeader('Content-Disposition', `attachment; filename=\"SK-BSS-${user.name}.pdf\"`);\r\n\r\n// Pipe output PDF ke response\r\ndoc.pipe(res);\r\n\r\n// Tambahkan konten ke PDF\r\ndoc.fontSize(20).text(`Surat Keputusan Berhenti Studi Sementara Tahun Ajaran 2024/2025 ${pengajuan.fakultas}`, { align: 'center' });\r\ndoc.moveDown(0.1);\r\n\r\npengajuan.forEach((pengajuan, index) => {\r\n  doc.fontSize(12).text(`${index + 1}. Nomor surat: ${pengajuan.id}`);\r\n  doc.text(`   Nama: ${pengajuan.name}`);\r\n  doc.text(`   Nim: ${pengajuan.nim}`);\r\n  doc.text(`   SKS: ${pengajuan.sks}`);\r\n  doc.moveDown(0.1);\r\n});\r\n\r\n// Selesaikan dokumen\r\ndoc.end();\r\n}\r\n"],"file":"skController.dev.js"}