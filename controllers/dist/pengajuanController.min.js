"use strict";function _defineProperty(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}var db=require("../models");exports.showRegisBss=function(r,n){var a,s,t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(db.User.findOne({where:{id:r.session.user.id}}));case 3:a=e.sent,s=r.session.user,t=s.role,n.render("user/pendaftaranBSS",{title:"Pendaftaran BSS",user:a,userRole:t}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error fetching user:",e.t0),n.status(500).send("Internal Server Error");case 13:case"end":return e.stop()}},null,null,[[0,9]])},exports.showProfile=function(r,n){var a,s,t,u,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=r.session.user.id,t=r.session.user,u=t.role,e.next=6,regeneratorRuntime.awrap(db.Pengajuan.findOne({where:{userId:s}}));case 6:if(e.sent){e.next=9;break}throw new Error("Pengajuan not found");case 9:return e.next=11,regeneratorRuntime.awrap(db.User.findAll({where:{userId:o.id},include:[{model:db.User}]}));case 11:o=e.sent,n.render("user/profile",(_defineProperty(a={title:"Profile",user:r.session.user},"user",o),_defineProperty(a,"userRole",u),a)),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),console.error("Error fetching approvals:",e.t0),n.status(500).send("Internal Server Error");case 19:case"end":return e.stop()}},null,null,[[0,15]])},exports.showPanduan=function(r,n){var a,s,t,u,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.session.user.id,s=r.session.user,t=s.role,e.next=6,regeneratorRuntime.awrap(db.Pengajuan.findOne({where:{userId:a}}));case 6:if(u=e.sent){e.next=9;break}return e.abrupt("return",n.status(404).send("Data pengajuan tidak ditemukan"));case 9:o=u.dokumen_pendukung?u.dokumen_pendukung.split(","):[],n.render("user/panduan",{title:"Panduan",dokumenPendukung:o,userRole:t}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Error fetching supporting documents:",e.t0),n.status(500).send("Internal Server Error");case 17:case"end":return e.stop()}},null,null,[[0,13]])},exports.showStatus=function(r,n){var a,s,t,u,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.session.user.id,s=r.session.user,t=s.role,e.next=6,regeneratorRuntime.awrap(db.Pengajuan.findOne({where:{userId:a}}));case 6:if(u=e.sent){e.next=9;break}throw new Error("Pengajuan not found");case 9:return e.next=11,regeneratorRuntime.awrap(db.Approval.findAll({where:{pengajuanId:u.id},include:[{model:db.Pengajuan}]}));case 11:o=e.sent,n.render("user/status",{title:"Status Pengajuan",user:r.session.user,approvals:o,userRole:t}),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),console.error("Error fetching approvals:",e.t0),n.status(500).send("Internal Server Error");case 19:case"end":return e.stop()}},null,null,[[0,15]])},exports.showRiwayat=function(e,r){var n=e.session.user.role;r.render("user/riwayatpengajuan",{title:"riwayatpengajuan",userRole:n})},exports.createPermohonanBss=function(r,n){var a,s,t,u,o,i,l,d,c,p,f,g,h,m;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.body,s=a.nama_lengkap,t=a.nim,u=a.tanggal_lahir,o=a.jenis_kelamin,i=a.alamat,l=a.no_hp,d=a.departement,c=a.fakultas,p=a.kendala_bss,f=a.alasan_berhenti,g=null,r.file&&(g=r.file.filename),h=r.session.user.id,e.next=7,regeneratorRuntime.awrap(db.Pengajuan.create({nama_lengkap:s,nim:t,tanggal_lahir:u,jenis_kelamin:o,alamat:i,no_hp:l,departement:d,fakultas:c,kendala_bss:p,alasan_berhenti:f,dokumen_pendukung:g,userId:h}));case 7:m=e.sent,console.log("Permohonan berhasil dibuat:",m),n.redirect("/pendaftaranBss"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Terjadi kesalahan saat membuat permohonan:",e.t0),n.status(500).json({message:"Terjadi kesalahan pada server",error:e.t0});case 16:case"end":return e.stop()}},null,null,[[0,12]])};
//# sourceMappingURL=pengajuanController.min.js.map
