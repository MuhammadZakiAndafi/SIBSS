{"version":3,"sources":["skController.js"],"names":["db","require","PDFDocument","fs","exports","res","userId","userlogin","userRole","pengajuan","sks","regeneratorRuntime","async","_context","prev","next","req","session","user","id","showSk","role","awrap","Pengajuan","findOne","where","sent","SuratKeputusan","findAll","pengajuanId","model","title","t0","status","send","stop","doc","_context2","include","render","setHeader","concat","name","fontSize","text","fakultas","align","moveDown","forEach","index","nim","end"],"mappings":"aAAA,IAAMA,GAAKC,QAAQ,aACbC,YAAcD,QAAQ,UADpBE,GAAGF,QAAQ,MACnBG,QAAMF,OAAW,SAAGD,EAAQI,GAAX,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,OAAAF,EAAAC,KAAA,EACNb,EAAQe,EAAnBC,QAAAC,KAAAC,GAKUZ,EAAYS,EAAIC,QAAQC,KAH1BE,EAASb,EAAAc,KAHAR,EAAAE,KAAA,EAAAJ,mBAAAW,MAGAtB,GAAAuB,UAAAC,QAAA,CAAAC,MAAA,CAAAnB,OAAAA,MAHA,KAAA,EAAA,OAGAG,EAHAI,EAAAa,KAAAb,EAAAE,KAAA,EAAAJ,mBAAAW,MAGAtB,GAAA2B,eAAAC,QAAA,CAAAH,MAAA,CAAAI,YAAApB,EAAAU,IAEPb,QAAAA,CAFO,CAAAwB,MAEMb,GAAAA,eALN,KAAA,EAGAP,EAHAG,EAAAa,KAOPlB,EAAAA,OAAAA,sBAA2B,CACjCE,IAAAA,EAWGqB,MAAO,kBAhBGvB,SAAAA,IAHAK,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAAF,EAAAC,KAAA,GAAAD,EAAAmB,GAAAnB,EAAA,MAAA,GAUFP,QAAAA,MAAAA,kCAAAA,EAAAA,IAAFD,EAAA4B,OAAA,KAAAC,KAAA,yBAVI,KAAA,GAAA,IAAA,MAAA,OAAArB,EAAAsB,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA,OASP1B,QAAAA,WANO,SAAAO,EAAAX,GAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA0B,EAAA,OAAAzB,mBAAAC,MAAA,SAAAyB,GAAA,OAAA,OAAAA,EAAAvB,KAAAuB,EAAAtB,MAAA,KAAA,EAAA,OAAAT,EAAAU,EAAAC,QAAAC,KAAAC,GAAAZ,EAAAS,EAAAC,QAAAC,KAUXO,EAAOlB,EAAAc,KAVIgB,EAAAtB,KAAA,EAAAJ,mBAAAW,MAS+BtB,GAAAuB,UAAAC,QAAA,CAE1Cc,MAAAA,CAAAA,OAAUhC,MAXC,KAAA,EAAA,OAUJG,EAVI4B,EAAAX,KAAAW,EAAAtB,KAAA,EAAAJ,mBAAAW,MAWFtB,GAAA2B,eAAAC,QAAA,CAFiCH,MAT/B,CAAAI,YAAApB,EAAAU,IAmCXmB,QAAS,CAAC,CAACR,MAAO9B,GAAGuB,eAnCV,KAAA,EAWDb,EAXC2B,EAAAX,KAcbrB,EAAAA,OAAIkC,sBAAO,CACR7B,IAAAA,EACAqB,MAAAA,kBACAvB,SAAAA,IA4BD4B,EAAM,IAAIlC,YA7CCG,EAAAmC,UAAA,eAAA,mBAAAnC,EAAAmC,UAAA,sBAAA,gCAAAC,OAAAvB,KAAAwB,KAAA,UAqBbrC,EAAAA,KAAAA,GArBa+B,EAAAO,SAAA,IAAAC,KAAA,mEAAAH,OAAAhC,EAAAoC,UAAA,CAAAC,MAAA,WAAAV,EAAAW,SAAA,IAAAtC,EAAAuC,QAAA,SAAAvC,EAAAwC,GAAAb,EAAAO,SAAA,IAAAC,KAAA,GAAAH,OAAAQ,EAAA,EAAA,mBAAAR,OAAAhC,EAAAU,KAAjBiB,EAAAQ,KAAA,YAAAH,OAAAhC,EAAAiC,OA2DEN,EAAIQ,KAAJ,WAAAH,OAAoBhC,EAAUyC,MAlChC9C,EAAAA,KAAAA,WAAAA,OAAqBK,EAAAC,MAAA0B,EAAAW,SAAA,MAAAX,EAAAe,MAzBJ,KAAA,GAAA,IAAA,MAAA,OAAAd,EAAAF","file":"skController.min.js","sourcesContent":["const db = require('../models');\r\nconst PDFDocument = require('pdfkit');\r\nconst fs = require(\"fs\");\r\n\r\nexports.showSk = async (req, res) => {\r\n  try {\r\n    const userId = req.session.user.id; // Ambil userId dari pengguna yang sedang login\r\n    const userlogin = req.session.user;\r\n    const userRole = userlogin.role; // Mendapatkan role user\r\n    // Ambil pengajuan yang terhubung dengan userId\r\n    const pengajuan = await db.Pengajuan.findOne({\r\n      where: { userId: userId }\r\n    });\r\n    const sks = await db.SuratKeputusan.findAll({\r\n      where: { pengajuanId: pengajuan.id },\r\n      include: [{model: db.Pengajuan}]\r\n    });\r\n\r\n    res.render('user/suratkeputusan', {\r\n       sks,\r\n       title: 'Surat Keputusan',\r\n       userRole\r\n       });\r\n  } catch (error) {\r\n    console.error('Error fetching surat keputusan:', error);\r\n    res.status(500).send('Internal Server Error');\r\n  }\r\n};\r\n\r\nexports.downloadSK = async (req, res) => {\r\n  const userId = req.session.user.id; // Ambil userId dari pengguna yang sedang login\r\n    const userlogin = req.session.user;\r\n    const userRole = userlogin.role; // Mendapatkan role user\r\n    // Ambil pengajuan yang terhubung dengan userId\r\n    const pengajuan = await db.Pengajuan.findOne({\r\n      where: { userId: userId }\r\n    });\r\n    const sks = await db.SuratKeputusan.findAll({\r\n      where: { pengajuanId: pengajuan.id },\r\n      include: [{model: db.Pengajuan}]\r\n    });\r\n\r\n    res.render('user/suratkeputusan', {\r\n       sks,\r\n       title: 'Surat Keputusan',\r\n       userRole\r\n       });\r\n\r\n// Buat dokumen PDF baru\r\nconst doc = new PDFDocument();\r\nres.setHeader('Content-Type', 'application/pdf');\r\nres.setHeader('Content-Disposition', `attachment; filename=\"SK-BSS-${user.name}.pdf\"`);\r\n\r\n// Pipe output PDF ke response\r\ndoc.pipe(res);\r\n\r\n// Tambahkan konten ke PDF\r\ndoc.fontSize(20).text(`Surat Keputusan Berhenti Studi Sementara Tahun Ajaran 2024/2025 ${pengajuan.fakultas}`, { align: 'center' });\r\ndoc.moveDown(0.1);\r\n\r\npengajuan.forEach((pengajuan, index) => {\r\n  doc.fontSize(12).text(`${index + 1}. Nomor surat: ${pengajuan.id}`);\r\n  doc.text(`   Nama: ${pengajuan.name}`);\r\n  doc.text(`   Nim: ${pengajuan.nim}`);\r\n  doc.text(`   SKS: ${pengajuan.sks}`);\r\n  doc.moveDown(0.1);\r\n});\r\n\r\n// Selesaikan dokumen\r\ndoc.end();\r\n}\r\n"]}