{"version":3,"sources":["createSK.js"],"names":["PDFDocument","require","fs","exports","downloadSK","req","res","userId","userlogin","userRole","pengajuan","sks","doc","regeneratorRuntime","async","_context","prev","next","session","user","id","role","awrap","db","Pengajuan","findOne","where","sent","SuratKeputusan","findAll","pengajuanId","model","title","setHeader","concat","name","pipe","moveDown","fontSize","text","index","nim","t0","console","error","send","stop"],"mappings":"aAAA,IAAMA,YAAcC,QAAQ,UACtBC,GAAKD,QAAQ,MADbD,GAAAA,QAAcC,aACpBE,QAAQC,WAAU,SAAlBC,EAAAC,GAAkB,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,OAAAF,EAAAC,KAAA,EACVT,EAAWF,EAAAa,QAAnBC,KAAAC,GAKUZ,EAAYH,EAAIa,QAAQC,KAH1Bf,EAAaI,EAAAa,KAHHN,EAAAE,KAAA,EAAAJ,mBAAAS,MAGGC,GAAAC,UAAAC,QAAA,CAAAC,MAAA,CAAAnB,OAAAA,MAHH,KAAA,EAAA,OAGGG,EAHHK,EAAAY,KAAAZ,EAAAE,KAAA,EAAAJ,mBAAAS,MAGGC,GAAAK,eAAAC,QAAA,CAAAH,MAAA,CAAAI,YAAApB,EAAAU,IAEbb,QAAAA,CAFa,CAAAwB,MAEAb,GAAAA,eALH,KAAA,EAGGP,EAHHI,EAAAY,KAORlB,EAAAA,OAAAA,sBAA2B,CACjCE,IAAAA,EAWGqB,MAAO,kBAhBOvB,SAAAA,IAORG,EAAA,IAAAZ,YADoCM,EAAA2B,UAN5B,eAAA,mBAuBrB3B,EAAI2B,UAAU,sBAAd,gCAAAC,OAAqEf,KAAKgB,KAA1E,UAvBqBvB,EAAAwB,KAAA9B,GAUNwB,EAAAA,SAAAA,IAAAA,KAAAA,mEAAAA,OAAuBV,EAAAA,UAAAA,CAAAA,MAAAA,WAAzBR,EAAAyB,SADmC,IAE/BN,EAAAA,QAAAA,SAAKrB,EAAKc,GAAXZ,EAAA0B,SAAD,IAAAC,KAAC,GAAAL,OAADM,EAAA,EAAC,mBAAAN,OAADxB,EAAAU,KAFiCR,EAAA2B,KAAA,YAAAL,OAT3BxB,EAAAyB,OAmCnBvB,EAAI2B,KAAJ,WAAAL,OAAoBxB,EAAU+B,MAnCX7B,EAAA2B,KAAA,WAAAL,OAAAxB,EAAAC,MASXA,EAAAA,SATW,MAiBdF,EAAAA,MApBWM,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAAF,EAAAC,KAAA,GAAAD,EAAA2B,GAAA3B,EAAA,MAAA,GA8ClB4B,QAAQC,MAAM,wBAAd7B,EAAA2B,IAtBM9B,EAAAA,OAAAA,KAAMiC,KAAI7C,yBAxBE,KAAA,GAAA,IAAA,MAAA,OAAAe,EAAA+B,SAAA,KAAA,KAAA,CAAA,CAAA,EAAA","file":"createSK.min.js","sourcesContent":["const PDFDocument = require('pdfkit');\r\nconst fs = require(\"fs\");\r\nconst db = require('../models');\r\n\r\nexports.downloadSK = async (req, res) => {\r\n  try {\r\n  const userId = req.session.user.id; // Ambil userId dari pengguna yang sedang login\r\n    const userlogin = req.session.user;\r\n    const userRole = userlogin.role; // Mendapatkan role user\r\n    // Ambil pengajuan yang terhubung dengan userId\r\n    const pengajuan = await db.Pengajuan.findOne({\r\n      where: { userId: userId }\r\n    });\r\n    const sks = await db.SuratKeputusan.findAll({\r\n      where: { pengajuanId: pengajuan.id },\r\n      include: [{model: db.Pengajuan}]\r\n    });\r\n\r\n    res.render('user/suratkeputusan', {\r\n       sks,\r\n       title: 'Surat Keputusan',\r\n       userRole\r\n       });\r\n\r\n// Buat dokumen PDF baru\r\nconst doc = new PDFDocument();\r\nres.setHeader('Content-Type', 'application/pdf');\r\nres.setHeader('Content-Disposition', `attachment; filename=\"SK-BSS-${user.name}.pdf\"`);\r\n\r\n// Pipe output PDF ke response\r\ndoc.pipe(res);\r\n\r\n// Tambahkan konten ke PDF\r\ndoc.fontSize(20).text(`Surat Keputusan Berhenti Studi Sementara Tahun Ajaran 2024/2025 ${pengajuan.fakultas}`, { align: 'center' });\r\ndoc.moveDown(0.1);\r\n\r\npengajuan.forEach((pengajuan, index) => {\r\n  doc.fontSize(12).text(`${index + 1}. Nomor surat: ${pengajuan.id}`);\r\n  doc.text(`   Nama: ${pengajuan.name}`);\r\n  doc.text(`   Nim: ${pengajuan.nim}`);\r\n  doc.text(`   SKS: ${pengajuan.sks}`);\r\n  doc.moveDown(0.1);\r\n});\r\n\r\n// Selesaikan dokumen\r\ndoc.end();\r\n} catch (error) {\r\nconsole.error('Error generating PDF:', error);\r\nres.status(500).send('Internal Server Error');\r\n}\r\n};\r\n"]}